# AppDeudas
## Configuracion
### Base de datos

<details>
<Summary>SQL Database</Summary>

![Database Diagram](./Relational%20Database.png)

Tablas: 
- User:
    Id, Email, Password
- Debt_States:
    Id, StateName
- Debt:
    Id, Amount, CreationDate, UserId, StateId

Crear una base de datos postgresql local, en ella crear las tablas y columnas con el siguiente SQL:
```SQL
-- Independent Tables --
CREATE TABLE APP_USER (
 	ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	EMAIL VARCHAR(255) UNIQUE NOT NULL,
	PASSWORD VARCHAR(255) NOT NULL
);

CREATE TABLE DEBT_STATES (
	ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	STATE_NAME VARCHAR(255) NOT NULL
);

-- Tables with dependencies must be created after the independent tables --
CREATE TABLE DEBT(
	ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	AMOUNT DECIMAL(10,2) NOT NULL,
	CREATION_DATE DATE NOT NULL DEFAULT CURRENT_DATE,
    USER_ID INT NOT NULL REFERENCES APP_USER(ID) ON DELETE CASCADE,
    STATE_ID INT NOT NULL REFERENCES DEBT_STATES(ID) ON DELETE CASCADE
);

-- Example Independent Data --
INSERT INTO DEBT_STATES (STATE_NAME) VALUES ('Pending');
INSERT INTO DEBT_STATES (STATE_NAME) VALUES ('Partially Paid');
INSERT INTO DEBT_STATES (STATE_NAME) VALUES ('Paid');

INSERT INTO APP_USER (EMAIL, PASSWORD) VALUES ('user@test.com', 'afa77cbbefbb867645306abe9082dfa0.1d79d6a54aaf8f64d035b7799e1a2fb8314de4b122412e4d76533e6d7a7d71767cf5f93e3f2122525f3387ca85a07f06b503d652c45bcc39cadf6ec66389c166');
INSERT INTO APP_USER (EMAIL, PASSWORD) VALUES ('user2@test.com', '8b7d718cd02f3602b3c548975b7cd006.d743c7b27d5f9eaa9200cac243d5a0fd292b81569033f5b107989277553010be18b0a4f7edcfeb1c250fc8bd34aa0730116926bc370d6f92aae20107cb560465');

-- Example Dependent Data --
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (1000, CURRENT_DATE, 1, 1);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (2000, CURRENT_DATE, 1, 1);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (2500, CURRENT_DATE, 1, 2);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (100, CURRENT_DATE, 1, 2);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (20000, CURRENT_DATE, 1, 2);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (25000, CURRENT_DATE, 1, 3);

INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (3000, CURRENT_DATE, 2, 1);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (3500, CURRENT_DATE, 2, 3);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (8000, CURRENT_DATE, 2, 3);
INSERT INTO DEBT (AMOUNT, CREATION_DATE, USER_ID, STATE_ID) VALUES (700, CURRENT_DATE, 2, 3);
```
</details>

### Backend
<details>
<Summary>Backend</Summary>
1.Crear un archivo .env en la carpeta server y cambie las variables con el de su postgresql local:
```
DB_USER=postgres
DB_PASSWORD=postgres_password
DB_HOST=localhost
DB_NAME=postgres_db_name
DB_PORT=5432
PORT=5000
REDIS_URL=redis://localhost:6379
```
</details>

## Ejecucion
1. Configura la base de datos
2. Clona el repo: ```git clone https://github.com/JulianPGVeevart/AppDeudas.git```
3. instala las dependencias con ```npm run install-all```
4. configura las variables de entorno (.env)
5. Ejecuta el servidor y el cliente en local con ```npm run dev``` en la carpeta raiz /AppDeudas
6. Ejecuta tu servidor de Redis en el puerto 6379 (opcional para probar el uso de cache)
5. Abre el navegador en <link>http://localhost:5173</link> y verifica que funcione correctamente.

## Notas
Si creaste la informacion de prueba en la base de datos, intenta loggearte con las siguientes credenciales:
Usuario: "user@test.com"
Contraseña: "test"

Usuario: user2@test.com
Contraseña: testpass

y ya tendras informacion para probar el frontend.

## Decisiones Tecnicas
### Frontend
1. Se usa React con Vite simplemente por experiencia propia y comodidad.
2. Se usa localStorage para el manejo de la sesion activa ya que un sistema de autenticacion en el backend llevaria mas tiempo y complejidad, para fines de la prueba no lo considero necesario.
3. Uso de axios para las consultas al backend.
4. Uso de react-router-dom para el manejo de las rutas principales
5. Uso de panel de usuario para deslogear, cambio de tema (dark / light) y algunas acciones personalizadas como exportar json y mostrar sumatoria de deudas por estado o tabla de deudas con filtro.
6. Manejo mobile con menu desplegable, la vista principal contiene la lista de deudas con filtro o la sumatoria de deudas por estado.
7. Editar/Eliminar desde vista de tabla o vista detalle para mayor flexibilidad.

### Backend
1. Uso de Express como tecnologia base para la conexion con la base de datos
2. 3 modelos, 2 servicios ya que uno de los modelos se usa una unica vez por dependencia del otro (debt depende de debt_states) y que dicha tabla no se actualiza por ahora.
3. Uso de Redis como capa de cache ya que no se cuenta con AWS, Solo la informacion sobre las deudas es almacenada en cache, los datos de usuario y estados de deudas se manejan por contexto en el Frontend.
4. Manejo de encriptado con Salt para el password, no lo vi necesario para el email por temas de pruebas durante el desarrollo, pero podria ser igualmente encriptado.
5. Endpoint de las agregaciones segun el estado de deuda (Pending, Partially Paid, Paid) (Seccion En la App)
6. Endpoint para exportar deudas del usuario en JSON (Boton en el panel de Usuario)
7. Test unitarios de los servicios y los controladores.
8. Endpoint especifico para obtener deudas segun el estado de deuda (Pending, Partially Paid, Paid)
9. Se realiza validacion de que el usuario que pide por la informacion de las deudas sea el propietario de las mismas. (Usuario en sesion Vs Usuario de la deuda en la base de datos).